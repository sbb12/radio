# PocketBase Setup Guide

This guide will help you set up PocketBase collections for storing music generation callbacks and tracks.

## Environment Variables

Add these to your `.env` file:

```env
POCKETBASE_URL=http://127.0.0.1:8090
POCKETBASE_ADMIN_EMAIL=your_admin_email@example.com
POCKETBASE_ADMIN_PASSWORD=your_admin_password
```

## Collections to Create

### 1. `music_callbacks` Collection

This collection stores callback information from the Suno API.

**Fields:**
- `task_id` (Text, required) - The task ID from Suno API
- `callback_type` (Select, required) - Options: `text`, `first`, `complete`, `error`
- `status_code` (Number, required) - HTTP status code (200, 400, 451, 500)
- `message` (Text) - Status message from the API
- `raw_data` (JSON) - Complete raw callback data as JSON string
- `received_at` (Date, required) - When the callback was received

**Indexes:**
- Create an index on `task_id` and `callback_type` for faster lookups

### 2. `music_tracks` Collection

This collection stores individual music tracks generated by the Suno API.

**Fields:**
- `track_id` (Text, required, unique) - The unique track ID from Suno API
- `task_id` (Text, required) - The task ID this track belongs to
- `title` (Text) - Track title
- `prompt` (Text) - Generation prompt/lyrics
- `model_name` (Text) - Model used for generation
- `tags` (Text) - Music tags
- `duration` (Number) - Duration in seconds
- `audio_url` (URL) - Generated audio file URL
- `source_audio_url` (URL) - Original audio file URL
- `stream_audio_url` (URL) - Streaming audio URL
- `source_stream_audio_url` (URL) - Original streaming audio URL
- `image_url` (URL) - Cover image URL
- `source_image_url` (URL) - Original cover image URL
- `create_time` (Text) - Creation time from API
- `callback_type` (Select) - Callback type when track was received
- `created_at` (Date, required) - When the record was created

**Indexes:**
- Create a unique index on `track_id`
- Create an index on `task_id` for faster lookups

## Setup Steps

1. **Install PocketBase** (if not already installed):
   - Download from https://pocketbase.io/docs/
   - Run `./pocketbase serve` to start the server

2. **Create Admin Account**:
   - Open http://127.0.0.1:8090/_/ in your browser
   - Create an admin account

3. **Create Collections**:
   - Go to Collections in the admin panel
   - Create the two collections listed above
   - Add all the fields with the specified types
   - Set up the indexes as mentioned

4. **Set Permissions**:
   - For `music_callbacks`: Set create permission to "Admin only" (since only server-side code creates these)
   - For `music_tracks`: Set create permission to "Admin only"

5. **Update Environment Variables**:
   - Add the PocketBase URL and admin credentials to your `.env` file

## Testing

After setup, test the callback endpoint by sending a POST request to `/api/music/callback` with sample callback data. Check your PocketBase admin panel to verify records are being created.

